<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shaka Player Embedded: shaka::memory::V8HeapTracer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Shaka Player Embedded
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceshaka.html">shaka</a></li><li class="navelem"><a class="el" href="namespaceshaka_1_1memory.html">memory</a></li><li class="navelem"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html">V8HeapTracer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classshaka_1_1memory_1_1V8HeapTracer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">shaka::memory::V8HeapTracer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="v8__heap__tracer_8h_source.html">v8_heap_tracer.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for shaka::memory::V8HeapTracer:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classshaka_1_1memory_1_1V8HeapTracer.png" usemap="#shaka::memory::V8HeapTracer_map" alt=""/>
  <map id="shaka::memory::V8HeapTracer_map" name="shaka::memory::V8HeapTracer_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a599418c2c6664a3841e43e0f6e8fdc37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a599418c2c6664a3841e43e0f6e8fdc37">V8HeapTracer</a> (<a class="el" href="classshaka_1_1memory_1_1HeapTracer.html">HeapTracer</a> *heap_tracer, <a class="el" href="classshaka_1_1memory_1_1ObjectTracker.html">ObjectTracker</a> *object_tracker)</td></tr>
<tr class="separator:a599418c2c6664a3841e43e0f6e8fdc37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab825cf97985ce85cfed1d5cd40c9d84b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#ab825cf97985ce85cfed1d5cd40c9d84b">~V8HeapTracer</a> () override</td></tr>
<tr class="separator:ab825cf97985ce85cfed1d5cd40c9d84b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c71a510cc0b61e1644c6a61d681dcb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a34c71a510cc0b61e1644c6a61d681dcb">AbortTracing</a> () override</td></tr>
<tr class="separator:a34c71a510cc0b61e1644c6a61d681dcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e823ac6ad633d4b2bac545b3bdb2e8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a4e823ac6ad633d4b2bac545b3bdb2e8a">TracePrologue</a> () override</td></tr>
<tr class="separator:a4e823ac6ad633d4b2bac545b3bdb2e8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aba7c7cc353316c92213c8f85d61388"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a6aba7c7cc353316c92213c8f85d61388">TraceEpilogue</a> () override</td></tr>
<tr class="separator:a6aba7c7cc353316c92213c8f85d61388"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a032a4eadc2db13ec2317f7b9cb8b7b36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a032a4eadc2db13ec2317f7b9cb8b7b36">EnterFinalPause</a> () override</td></tr>
<tr class="separator:a032a4eadc2db13ec2317f7b9cb8b7b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7500fe41b66a708bb7e3ffc1a7ec5408"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a7500fe41b66a708bb7e3ffc1a7ec5408">RegisterV8References</a> (const InternalFieldList &amp;internal_fields) override</td></tr>
<tr class="separator:a7500fe41b66a708bb7e3ffc1a7ec5408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9469197ac510b0d27467d955361cc79d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classshaka_1_1memory_1_1V8HeapTracer.html#a9469197ac510b0d27467d955361cc79d">AdvanceTracing</a> (double deadline_ms, AdvanceTracingActions) override</td></tr>
<tr class="separator:a9469197ac510b0d27467d955361cc79d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This wraps the normal <a class="el" href="classshaka_1_1memory_1_1HeapTracer.html">HeapTracer</a> in an interface that can be used by V8 to track objects. Methods defined here will be called by V8 when it decides that a GC needs to be run.</p>
<p>This explains how the V8 GC works and how we interact with it:</p>
<p>There are two kinds of objects that are managed by different GCs, a JavaScript object (v8::Value) which is handled by the V8 gc, and <a class="el" href="classshaka_1_1BackingObject.html">BackingObject</a>'s which are handled by <a class="el" href="classshaka_1_1memory_1_1ObjectTracker.html">ObjectTracker</a>. When the V8 GC runs, we need to tell it what objects we hold so it knows the V8 objects to delete. That is the purpose of this class.</p>
<p>When a V8 pass start, V8 will call TracePrologue. Then it will traverse its objects, marking alive objects. <a class="el" href="classshaka_1_1Any.html">Any</a> object that looks like a wrapper will be added to a list. Once the traversal is done, it will call RegisterV8References passing in the list. Then it will call AdvanceTracing to allow us to traverse our heap. We should traverse our alive objects and any wrapper objects given to us. We should then (a) mark these object as alive so we don't free them, and (b) tell V8 about any objects we hold.</p>
<p>When we tell V8 about alive objects, it may need to do some more traversals, which may in turn find more wrappers. If this happens, it will call RegisterV8References and AdvanceTracing again.</p>
<p>At points between method calls, it is possible for JavaScript to run. Because this runs on the event thread, it is not possible for JavaScript to run while one of these methods are being called, but between it is possible. V8 monitors all the objects and will ensure that any new objects will be given to us.</p>
<p>After V8 has traced every object TraceEpilogue is called. We use this to free any object that is not marked as alive. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8h_source.html#l00061">61</a> of file <a class="el" href="v8__heap__tracer_8h_source.html">v8_heap_tracer.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a599418c2c6664a3841e43e0f6e8fdc37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a599418c2c6664a3841e43e0f6e8fdc37">&sect;&nbsp;</a></span>V8HeapTracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">shaka::memory::V8HeapTracer::V8HeapTracer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classshaka_1_1memory_1_1HeapTracer.html">HeapTracer</a> *&#160;</td>
          <td class="paramname"><em>heap_tracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classshaka_1_1memory_1_1ObjectTracker.html">ObjectTracker</a> *&#160;</td>
          <td class="paramname"><em>object_tracker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00026">26</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="ab825cf97985ce85cfed1d5cd40c9d84b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab825cf97985ce85cfed1d5cd40c9d84b">&sect;&nbsp;</a></span>~V8HeapTracer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">shaka::memory::V8HeapTracer::~V8HeapTracer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00030">30</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a34c71a510cc0b61e1644c6a61d681dcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34c71a510cc0b61e1644c6a61d681dcb">&sect;&nbsp;</a></span>AbortTracing()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shaka::memory::V8HeapTracer::AbortTracing </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 when a GC is aborted. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00032">32</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="a9469197ac510b0d27467d955361cc79d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9469197ac510b0d27467d955361cc79d">&sect;&nbsp;</a></span>AdvanceTracing()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool shaka::memory::V8HeapTracer::AdvanceTracing </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>deadline_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AdvanceTracingActions&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 to advance the GC run. We should only take |deadline_ms| time to complete, telling V8 whether there is more work to do. </p><dl class="section return"><dt>Returns</dt><dd>True if there is more work to do, false if done. </dd></dl>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00059">59</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="a032a4eadc2db13ec2317f7b9cb8b7b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a032a4eadc2db13ec2317f7b9cb8b7b36">&sect;&nbsp;</a></span>EnterFinalPause()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shaka::memory::V8HeapTracer::EnterFinalPause </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 when entering the final marking phase. There will be no more incremental marking calls. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00051">51</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="a7500fe41b66a708bb7e3ffc1a7ec5408"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7500fe41b66a708bb7e3ffc1a7ec5408">&sect;&nbsp;</a></span>RegisterV8References()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shaka::memory::V8HeapTracer::RegisterV8References </td>
          <td>(</td>
          <td class="paramtype">const InternalFieldList &amp;&#160;</td>
          <td class="paramname"><em>internal_fields</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 to tell us about wrapper objects. The pair contains the internal field values of the wrapper object. We should store the values and process them only in AdvanceTracing. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00053">53</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="a6aba7c7cc353316c92213c8f85d61388"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aba7c7cc353316c92213c8f85d61388">&sect;&nbsp;</a></span>TraceEpilogue()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shaka::memory::V8HeapTracer::TraceEpilogue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 when a GC pass ends. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00044">44</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<a id="a4e823ac6ad633d4b2bac545b3bdb2e8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e823ac6ad633d4b2bac545b3bdb2e8a">&sect;&nbsp;</a></span>TracePrologue()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shaka::memory::V8HeapTracer::TracePrologue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called by V8 when a GC pass begins. </p>

<p>Definition at line <a class="el" href="v8__heap__tracer_8cc_source.html#l00038">38</a> of file <a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>shaka/src/memory/<a class="el" href="v8__heap__tracer_8h_source.html">v8_heap_tracer.h</a></li>
<li>shaka/src/memory/<a class="el" href="v8__heap__tracer_8cc_source.html">v8_heap_tracer.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
